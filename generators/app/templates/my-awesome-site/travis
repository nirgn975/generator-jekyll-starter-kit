sudo: required
dist: trusty

language: ruby
rvm:
  - 2.3

env:
  global:
    # speeds up installation of html-proofer
  - NOKOGIRI_USE_SYSTEM_LIBRARIES=true

before_install:
  - npm install npm -g
  - bundle update

install:
  - npm install
  - bundle install
  - gem install html-proofer

  # Install lighthouse
  - npm install -g GoogleChrome/lighthouse
  - export LIGHTHOUSE_CHROMIUM_PATH="$(pwd)/chrome-linux/chrome"
  - npm explore -g lighthouse -- ./lighthouse-core/scripts/download-chrome.sh
  - mv $(npm root -g)/lighthouse/chrome-linux .
  - $LIGHTHOUSE_CHROMIUM_PATH --version
  - (cd $(npm root -g)/lighthouse/lighthouse-cli && npm install && npm run build)

script:
  - npm run gulp build
  - htmlproofer ./_site
  - lighthouse http://localhost:3000/ --output-json --output-path=./validate/log.json
  - ./validate/checklog.js ./validate/log.json
